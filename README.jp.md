# Folderサーバー

> [!IMPORTANT]
> 現在はmacOS専用です。
> 
> コードをビルドすれば、たぶんどのプラットフォームでも動作すると思いますが、getIconは完全にmacOS用ですのでご理解ください💦

## 起動方法

1. ダウンロードしてフォルダーを展開
2. settings.jsonに公開するフォルダーの情報を記述（後述参照）
3. FolderWebSarverをターミナルから実行

## 説明

+ 指定されたフォルダーの内容をブラウザで確認できるようにする
+ 画像ファイルのときは専用のHTMLページで簡単にブラウズできるようにする
	+ 画像のプラウズは横スクロール
	+ 同階層の画像を横スクロールでページを捲る感覚で見ることができる
	+ フォルダーに`__option_R2L__`という名称のファイルがあるときは、横スクロールの向きが逆になる
+ サーバーの設定は同階層にあるsettings.jsonによって行う

## 設定ファイル

setting.jsonの例

```json
{
	"config": {
		"server": { "port": 9999 },
		"templates": {
			"index": "./Templates/index.html",
			"folder": "./Templates/folder.html",
			"image": "./Templates/image.html",
			"imageR2L": "./Templates/imageR2L.html"
		}
	},
	"folders": [
		"/VolumeA/Folder-1/",
		"/VolumeB/Folder-2/",
		"/VolumeB/Folder-3/"
	],
	"ignores": [
		"\\..*",
		"Icon"
	]
}
```

## フォルダー

最初に表示されるフォルダーの指定は、必ず絶対パスで行わなければならない。

## テンプレート

テンプレートは特別なオブジェクトを表示するために使われる。
テンプレートは、Goのhtml/templateフォーマットで記述する。

テンプレートの指定は、パスで行うが、相対パスでも構わない。

以下は、利用されるテンプレートの説明。

### index

indexはトップページの表示に使われる。
最初に表示されるフォルダーは、`settings.json`の`folders`で指定されたフォルダー。
別のボリュームに存在しても構わない。

### forder

フォルダー内のオブジェクトを表示するためのテンプレート。

### image、imageR2L

画像を表示するときに使われる。
folderで表示されたオブジェクトリストから画像がクリックされたときに、このテンプレートが使われる。
選択された画像を中心に、同階層にある画像ファイルを横スクロールでページを捲るように閲覧することができる。
タップの仕方で、全画面モードになる。
元のフォルダー表示に戻るためには、画面をタップして全画面表示を解除し、ブラウザの戻るボタンで戻る。

フォルダー内に`__option_R2L__`という名称のファイルがあるときは、横スクロールの向きが逆になる。
縦書きの文章が画像にあるときに、自然な感じで横スクロールすることができる。

### 非表示オブジェクト

リンクに表示させないオブジェクトは、`ignores`に名前で登録する（例題参照）。

例題では、次のようなものが表示されない。
+ .で始まる名前を持つすべてのオブジェクト
+ macOSのカスタムアイコンファイル

## アイコン

ファイルとフォルダーのアイコンは、Finderと同じに見えるようにする。
そのために、アイコンを取り出すCLIラッパーをSwiftで作成した。

> getIcon

呼び出しは次のように行う。

```
getIcon <フルパス> <iconサイズ>
```

iconサイズは省略可能。
省略時にはデフォルトサイズになる。

返される値は、当該パスのアイコンをサイズで示した正方形のpngに変換したBase64文字列。
